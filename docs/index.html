<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸®åŠ©æ–‡æ¡£ - WeMD | å¾®ä¿¡å…¬ä¼—å· Markdown æ’ç‰ˆç¼–è¾‘å™¨</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="WeMD å¸®åŠ©æ–‡æ¡£ã€‚å­¦ä¹ å¦‚ä½•ä½¿ç”¨ WeMD è¿›è¡Œå¾®ä¿¡å…¬ä¼—å· Markdown æ’ç‰ˆï¼ŒåŒ…æ‹¬å¿«é€Ÿä¸Šæ‰‹æ•™ç¨‹ã€å›¾åºŠé…ç½®ã€ä¸»é¢˜å®šåˆ¶ç­‰å®Œæ•´æŒ‡å—ã€‚">
    <meta name="keywords" content="WeMD, å¾®ä¿¡å…¬ä¼—å·, Markdown, æ’ç‰ˆ, ç¼–è¾‘å™¨, æ•™ç¨‹, æ–‡æ¡£">
    <meta name="author" content="WeMD Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://wemd.app/docs/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wemd.app/docs/">
    <meta property="og:title" content="å¸®åŠ©æ–‡æ¡£ - WeMD">
    <meta property="og:description" content="WeMD å¸®åŠ©æ–‡æ¡£ã€‚å­¦ä¹ å¦‚ä½•ä½¿ç”¨ WeMD è¿›è¡Œå¾®ä¿¡å…¬ä¼—å· Markdown æ’ç‰ˆï¼ŒåŒ…æ‹¬å¿«é€Ÿä¸Šæ‰‹æ•™ç¨‹ã€å›¾åºŠé…ç½®ã€ä¸»é¢˜å®šåˆ¶ç­‰å®Œæ•´æŒ‡å—ã€‚">
    <meta property="og:image" content="https://wemd.app/og-image.png">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="WeMD">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://wemd.app/docs/">
    <meta name="twitter:title" content="å¸®åŠ©æ–‡æ¡£ - WeMD">
    <meta name="twitter:description" content="WeMD å¸®åŠ©æ–‡æ¡£ã€‚å­¦ä¹ å¦‚ä½•ä½¿ç”¨ WeMD è¿›è¡Œå¾®ä¿¡å…¬ä¼—å· Markdown æ’ç‰ˆã€‚">
    <meta name="twitter:image" content="https://wemd.app/og-image.png">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "WeMD å¸®åŠ©æ–‡æ¡£",
        "url": "https://wemd.app/docs/",
        "description": "WeMD æ˜¯ä¸€æ¬¾ä¸“ä¸ºå¾®ä¿¡å…¬ä¼—å·è®¾è®¡çš„ Markdown æ’ç‰ˆç¼–è¾‘å™¨ï¼Œæ”¯æŒæœ¬åœ°ä¼˜å…ˆã€å¤šä¸»é¢˜åˆ‡æ¢ã€‚",
        "publisher": {
            "@type": "Organization",
            "name": "WeMD Team",
            "logo": {
                "@type": "ImageObject",
                "url": "https://wemd.app/favicon.svg"
            }
        }
    }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <!-- Fonts (local) -->
    <link rel="stylesheet" href="/fonts/local-fonts.css">

    <!-- Highlight.js Theme (Light) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <style>
        /* Override Tailwind Typography's default pre background to match HLJS Github Light */
        .prose pre {
            background-color: #f6f8fa !important;
            color: #24292e !important;
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            border-radius: 0.75rem;
            border: 1px solid #e1e4e8;
        }

        /* Ensure code block text uses proper specific styles */
        .prose pre code {
            background-color: transparent !important;
            color: inherit !important;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            border: none !important;
            padding: 0 !important;
        }

        /* Remove default backticks from Tailwind Typography for inline code */
        .prose :where(code):not(:where([class~="not-prose"] *))::before,
        .prose :where(code):not(:where([class~="not-prose"] *))::after {
            content: "" !important;
        }

        /* Style ONLY inline code (not inside pre) */
        .prose :not(pre)>code {
            color: #24292e;
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            border: 1px solid #eaecef;
        }

        /* Clean scrollbar for code blocks */
        .prose pre::-webkit-scrollbar {
            height: 8px;
        }

        .prose pre::-webkit-scrollbar-thumb {
            background: #d1d5da;
            border-radius: 4px;
        }

        .prose pre::-webkit-scrollbar-track {
            background: transparent;
        }

        /* Fix anchor positioning with sticky header */
        .prose h2,
        .prose h3 {
            scroll-margin-top: 6rem;
            /* 3.5rem header + 2.5rem buffer */
        }

        /* Fix ToC link colors - override browser default blue */
        #page-toc a {
            color: inherit;
            text-decoration: none;
        }

        #page-toc a:hover {
            color: #07c160;
        }

        #page-toc a.active {
            color: #07c160;
            border-left-color: #07c160;
        }
    </style>
    <!-- Reusing Main Script/CSS for Tailwind -->
    <script type="module" src="/src/main.js"></script>
    <style>
        /* Visual Cloak: Prevent FOUC - body hidden until JS reveals */
        body {
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none;
        }
    </style>
    <script>
        // Visual Cloak Reveal
        document.addEventListener('DOMContentLoaded', () => {
            requestAnimationFrame(() => {
                document.body.style.opacity = '1';
                document.body.style.pointerEvents = 'auto';
            });
        });
    </script>
</head>

<body class="font-sans antialiased text-gray-900 bg-gray-50 selection:bg-wemd-green selection:text-white">

    <!-- Decorative Background -->
    <div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
        <!-- Top Green Glow -->
        <div
            class="absolute -top-[20%] right-[-10%] w-[800px] h-[800px] bg-green-200/20 rounded-full blur-3xl mix-blend-multiply opacity-70 animate-blob">
        </div>
        <!-- Bottom Blue Glow -->
        <div
            class="absolute top-[20%] left-[-10%] w-[600px] h-[600px] bg-blue-200/20 rounded-full blur-3xl mix-blend-multiply opacity-70 animate-blob animation-delay-2000">
        </div>
    </div>

    <!-- Floating Navbar -->
    <nav class="fixed top-4 left-0 right-0 z-50 px-4 md:px-0">
        <div class="glass mx-auto max-w-7xl h-16 rounded-2xl flex items-center justify-between px-6 transition-all duration-300 hover:shadow-md"
            style="opacity: 0;">
            <!-- Logo -->
            <a href="/" class="flex items-center gap-2.5">
                <img src="/logo.svg" alt="WeMD Logo" class="w-8 h-8" />
                <span class="font-bold text-lg tracking-tight text-gray-900">WeMD Docs</span>
            </a>

            <!-- Links (Desktop) -->
            <div class="hidden md:flex gap-4 items-center">
                <a href="/"
                    class="px-5 py-2 text-sm font-medium text-gray-500 rounded-full hover:text-wemd-green hover:bg-green-50/50 transition-all duration-300">è¿”å›é¦–é¡µ</a>
                <a href="https://github.com/tenngoxars/WeMD" target="_blank"
                    class="px-5 py-2 text-sm font-medium text-gray-500 rounded-full hover:text-wemd-green hover:bg-green-50/50 transition-all duration-300">GitHub</a>
                <a href="https://github.com/tenngoxars/WeMD/releases" target="_blank"
                    class="btn-primary relative overflow-hidden group px-6 py-2 text-sm min-w-0 shadow-green-500/30 hover:shadow-green-500/40">
                    <span class="relative z-10">ä¸‹è½½å®¢æˆ·ç«¯</span>
                    <div
                        class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent z-0">
                    </div>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
                aria-label="æ‰“å¼€èœå•">
                <i data-lucide="menu" class="w-6 h-6 text-gray-700"></i>
            </button>
        </div>
    </nav>

    <!-- Mobile Drawer Menu -->
    <div id="mobile-menu" class="fixed inset-0 z-[60] pointer-events-none opacity-0 transition-opacity duration-300"
        style="opacity: 0; pointer-events: none;">
        <!-- Backdrop -->
        <div id="mobile-menu-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <!-- Drawer -->
        <div id="mobile-menu-drawer"
            class="absolute top-0 right-0 h-full w-72 bg-white shadow-2xl translate-x-full transition-transform duration-300 ease-out"
            style="transform: translateX(100%);">
            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <span class="font-bold text-lg text-gray-900">èœå•</span>
                <button id="mobile-menu-close" class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
                    aria-label="å…³é—­èœå•">
                    <i data-lucide="x" class="w-5 h-5 text-gray-700"></i>
                </button>
            </div>
            <!-- Links -->
            <div class="p-6 space-y-4">
                <a href="/"
                    class="block py-3 px-4 text-gray-700 font-medium rounded-lg hover:bg-green-50 hover:text-wemd-green transition-all">
                    è¿”å›é¦–é¡µ
                </a>
                <a href="https://github.com/tenngoxars/WeMD" target="_blank"
                    class="block py-3 px-4 text-gray-700 font-medium rounded-lg hover:bg-green-50 hover:text-wemd-green transition-all">
                    GitHub
                </a>
                <a href="https://github.com/tenngoxars/WeMD/releases" target="_blank"
                    class="block py-3 px-4 bg-wemd-green text-white font-bold rounded-lg text-center shadow-lg hover:bg-[#06ad56] transition-all">
                    ä¸‹è½½å®¢æˆ·ç«¯
                </a>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="pt-28 min-h-screen max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-start">

            <!-- Sidebar (Left) - Floating Menu -->
            <aside class="hidden md:block md:col-span-3 lg:col-span-2 sticky top-28">
                <nav class="space-y-8 font-sans">
                    <!-- Tutorials -->
                    <div>
                        <div class="font-bold mb-4 uppercase text-[10px] tracking-[0.2em] text-gray-400">å…¥é—¨æ•™ç¨‹</div>
                        <ul class="space-y-2">
                            <li><a href="#tutorials/quick-start-user.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="tutorials/quick-start-user.md">ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹</a></li>
                            <li><a href="#tutorials/quick-start-dev.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="tutorials/quick-start-dev.md">å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹</a></li>
                        </ul>
                    </div>

                    <!-- Guides -->
                    <div>
                        <div class="font-bold mb-4 uppercase text-[10px] tracking-[0.2em] text-gray-400">æ“ä½œæŒ‡å—</div>
                        <ul class="space-y-2">
                            <li><a href="#guides/setup-image-hosting.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="guides/setup-image-hosting.md">é…ç½®å›¾åºŠ</a></li>
                            <li><a href="#guides/create-theme.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="guides/create-theme.md">æ–°å¢è‡ªå®šä¹‰ä¸»é¢˜</a></li>
                        </ul>
                    </div>

                    <!-- Reference -->
                    <div>
                        <div class="font-bold mb-4 uppercase text-[10px] tracking-[0.2em] text-gray-400">æŠ€æœ¯å‚è€ƒ</div>
                        <ul class="space-y-2">
                            <li><a href="#reference/hotkeys.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="reference/hotkeys.md">å¿«æ·é”®åˆ—è¡¨</a></li>
                            <li><a href="#reference/project-structure.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="reference/project-structure.md">é¡¹ç›®ç»“æ„</a></li>
                            <li><a href="#reference/dark-mode-algorithm.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="reference/dark-mode-algorithm.md">æ·±è‰²æ¨¡å¼ç®—æ³•</a></li>
                        </ul>
                    </div>

                    <!-- About -->
                    <div>
                        <div class="font-bold mb-4 uppercase text-[10px] tracking-[0.2em] text-gray-400">å…³äº</div>
                        <ul class="space-y-2">
                            <li><a href="#about/about.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="about/about.md">å…³äº WeMD</a></li>
                            <li><a href="#about/changelog.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="about/changelog.md">æ›´æ–°æ—¥å¿—</a></li>
                            <li><a href="#about/faq.md"
                                    class="block px-3 py-2 rounded-lg hover:bg-white/50 hover:text-wemd-green transition-all duration-200 text-gray-600 text-sm font-medium"
                                    data-doc="about/faq.md">å¸¸è§é—®é¢˜</a></li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area - Glass Card -->
            <main class="md:col-span-9 lg:col-span-8 min-w-0">
                <div class="glass-card p-10 md:p-14 min-h-[80vh]" style="opacity: 0;">
                    <div id="content-area"
                        class="prose prose-lg prose-headings:font-bold prose-headings:tracking-tight prose-a:text-wemd-green prose-img:rounded-xl max-w-none">
                        <!-- Markdown Content Will Be Rendered Here -->
                        <div class="animate-pulse flex space-x-4">
                            <div class="flex-1 space-y-6 py-1">
                                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                                <div class="space-y-3">
                                    <div class="h-4 bg-gray-200 rounded"></div>
                                    <div class="h-4 bg-gray-200 rounded"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <footer
                        class="mt-20 pt-8 border-t border-gray-100/50 text-sm text-gray-400 font-sans flex justify-between items-center">
                        <p>Â© 2025 WeMD Team.</p>
                        <p class="opacity-60 text-xs">Designed for WeChat Official Accounts.</p>
                    </footer>
                </div>
            </main>

            <!-- Sidebar (Right) - ToC -->
            <aside class="hidden lg:block lg:col-span-2 sticky top-28">
                <div class="pl-4">
                    <div class="font-bold mb-4 text-[10px] uppercase text-gray-400 tracking-[0.2em]">æœ¬é¡µç›®å½•</div>
                    <div id="page-toc"
                        class="space-y-1 text-sm text-gray-500 relative before:absolute before:inset-y-0 before:left-0 before:w-[2px] before:bg-gray-200/50">
                        <!-- ToC Items will be injected here -->
                    </div>
                </div>
            </aside>

        </div>
    </div>

    <script type="module">
        import { marked } from 'marked';
        import { markedHighlight } from "marked-highlight";

        // Optimize Highlight.js: Import Core + Specific Languages
        import hljs from 'highlight.js/lib/core';
        import bash from 'highlight.js/lib/languages/bash';
        import javascript from 'highlight.js/lib/languages/javascript';
        import typescript from 'highlight.js/lib/languages/typescript';
        import css from 'highlight.js/lib/languages/css';
        import xml from 'highlight.js/lib/languages/xml';
        import json from 'highlight.js/lib/languages/json';
        import markdown from 'highlight.js/lib/languages/markdown';
        import diff from 'highlight.js/lib/languages/diff';
        import plaintext from 'highlight.js/lib/languages/plaintext';

        hljs.registerLanguage('bash', bash);
        hljs.registerLanguage('javascript', javascript);
        hljs.registerLanguage('typescript', typescript);
        hljs.registerLanguage('css', css);
        hljs.registerLanguage('xml', xml);
        hljs.registerLanguage('html', xml);
        hljs.registerLanguage('json', json);
        hljs.registerLanguage('markdown', markdown);
        hljs.registerLanguage('diff', diff);
        hljs.registerLanguage('plaintext', plaintext);

        // Initialize Marked with Highlighting
        const renderer = new marked.Renderer();

        marked.use(
            markedHighlight({
                langPrefix: 'hljs language-',
                highlight(code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, { language }).value;
                }
            })
        );

        // ... existing container logic ...

        // NEW: Copy Button Logic
        // NEW: Copy Button Logic (Refined with Wrapper)
        function initCopyButtons() {
            const codeBlocks = contentArea.querySelectorAll('pre');
            codeBlocks.forEach(pre => {
                // Return if already processed (check if parent is our wrapper)
                if (pre.parentNode.classList.contains('code-wrapper')) return;

                // Create Wrapper
                const wrapper = document.createElement('div');
                wrapper.className = 'code-wrapper relative group my-6'; // Replicate margins if needed

                // Insert wrapper before pre
                pre.parentNode.insertBefore(wrapper, pre);

                // Move pre into wrapper
                wrapper.appendChild(pre);

                // Create Button
                const btn = document.createElement('button');
                btn.className = 'copy-btn absolute top-3 right-3 p-1.5 rounded-md bg-white border border-gray-200 text-gray-400 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:text-wemd-green hover:border-wemd-green focus:outline-none shadow-sm z-10';
                btn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" class="stroke-current" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                `;
                btn.title = "å¤åˆ¶/Copy";

                btn.addEventListener('click', async () => {
                    // Get text from code block
                    const code = pre.querySelector('code')?.innerText || pre.innerText;
                    try {
                        await navigator.clipboard.writeText(code);
                        // Success State
                        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-wemd-green"><path d="M20 6 9 17l-5-5"/></svg>`;
                        btn.classList.add('border-green-200', 'bg-green-50');
                        setTimeout(() => {
                            btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" class="stroke-current" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`;
                            btn.classList.remove('border-green-200', 'bg-green-50');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy', err);
                    }
                });

                wrapper.appendChild(btn);
            });
        }

        // Custom Extension for Container Blocks (::: tip/warning/etc)
        const containerExtension = {
            name: 'container',
            level: 'block',
            start(src) { return src.match(/:::/)?.index; },
            tokenizer(src) {
                const rule = /^::: *(\w+)(?: +([^\n]+))?\n([\s\S]+?)\n:::(?:\n|$)/;
                const match = rule.exec(src);
                if (match) {
                    return {
                        type: 'container',
                        raw: match[0],
                        variant: match[1].trim(),
                        title: match[2] ? match[2].trim() : '',
                        content: this.lexer.blockTokens(match[3].trim(), [])
                    };
                }
            },
            renderer(token) {
                const variant = token.variant;
                const title = token.title || variant.toUpperCase();

                let colorClass = 'bg-gray-100 border-gray-500'; // Default
                let icon = 'Info';

                switch (variant) {
                    case 'tip':
                    case 'info':
                        colorClass = 'bg-blue-50 border-blue-500 text-blue-900';
                        icon = 'ğŸ’¡';
                        break;
                    case 'warning':
                        colorClass = 'bg-yellow-50 border-yellow-500 text-yellow-900';
                        icon = 'âš ï¸';
                        break;
                    case 'danger':
                    case 'error':
                        colorClass = 'bg-red-50 border-red-500 text-red-900';
                        icon = 'ğŸ›‘';
                        break;
                    case 'success':
                        colorClass = 'bg-green-50 border-green-500 text-green-900';
                        icon = 'âœ…';
                        break;
                }

                const body = this.parser.parse(token.content);
                return `<div class="${colorClass} border-l-4 p-4 my-6 rounded-r-lg relative" role="alert">
                    <div class="font-bold flex items-center gap-2 mb-2">
                        <span>${icon}</span>
                        <span>${title}</span>
                    </div>
                    <div class="text-sm opacity-90">${body}</div>
                </div>`;
            }
        };

        marked.use({ extensions: [containerExtension] });

        const contentArea = document.getElementById('content-area');
        const sidebarLinks = document.querySelectorAll('[data-doc]');
        const pageTocContainer = document.getElementById('page-toc');
        let observer = null;

        async function loadDoc(docName) {
            try {
                // Remove active class from all
                sidebarLinks.forEach(link => {
                    link.classList.remove('bg-white', 'shadow-sm', 'text-wemd-green', 'font-bold');
                    link.classList.add('text-gray-600', 'hover:bg-white/50');
                });

                // Set active class
                const activeLink = document.querySelector(`[data-doc="${docName}"]`);
                if (activeLink) {
                    activeLink.classList.remove('text-gray-600', 'hover:bg-white/50');
                    activeLink.classList.add('bg-white', 'shadow-sm', 'text-wemd-green', 'font-bold');
                }

                const response = await fetch(`/docs/${docName}`);
                if (!response.ok) throw new Error('Document not found');
                const text = await response.text();

                // Parse with configured marked
                contentArea.innerHTML = marked.parse(text);
                window.scrollTo(0, 0); // Scroll to top

                // Generate shared ToC
                generateToC();

                // Initialize Scroll Spy
                initScrollSpy();

                // Initialize Copy Buttons (UX Improvement)
                initCopyButtons();

            } catch (error) {
                console.error(error);
                contentArea.innerHTML = `<div class="text-red-500 p-4 border border-red-200 bg-red-50 rounded">
                    <strong>æ— æ³•åŠ è½½æ–‡æ¡£</strong><br>
                    <span class="text-sm">${error.message}</span>
                </div>`;
            }
        }

        function generateToC() {
            if (!pageTocContainer) return;
            pageTocContainer.innerHTML = '';

            const headings = contentArea.querySelectorAll('h2, h3');
            if (headings.length === 0) return;

            // Track used IDs to ensure uniqueness
            const usedIds = new Map();

            headings.forEach(h => {
                const link = document.createElement('a');
                link.textContent = h.textContent;

                if (!h.id) {
                    let baseId = h.textContent
                        .trim()
                        .replace(/\s+/g, '-')
                        .replace(/[^\u4e00-\u9fa5\w-]/g, '');

                    if (usedIds.has(baseId)) {
                        const count = usedIds.get(baseId) + 1;
                        usedIds.set(baseId, count);
                        h.id = `${baseId}-${count}`;
                    } else {
                        usedIds.set(baseId, 1);
                        h.id = baseId;
                    }
                }
                link.href = '#' + h.id;
                link.dataset.target = h.id;

                let baseClasses = "block transition-all duration-200 truncate cursor-pointer py-1.5 border-l-2 border-transparent pl-4 hover:text-wemd-green hover:border-wemd-green/30";

                if (h.tagName === 'H2') {
                    link.className = `${baseClasses} text-gray-600 font-medium`;
                } else if (h.tagName === 'H3') {
                    link.className = `${baseClasses} text-gray-400 pl-8 text-xs`;
                }

                link.onclick = (e) => {
                    e.preventDefault();
                    const target = document.getElementById(h.id);
                    if (target) {
                        const headerOffset = 120;
                        const elementPosition = target.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.scrollY - headerOffset;

                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });
                    }
                };

                pageTocContainer.appendChild(link);
            });
        }


        function initScrollSpy() {
            if (observer) observer.disconnect();

            const headings = contentArea.querySelectorAll('h2, h3');
            if (headings.length === 0) return;

            const handleScroll = () => {
                let currentId = '';
                // Buffer to account for sticky header
                const buffer = 150;

                headings.forEach(h => {
                    const top = h.getBoundingClientRect().top;
                    if (top < buffer) {
                        currentId = h.id;
                    }
                });

                if (currentId) {
                    setActiveToc(currentId);
                } else if (headings.length > 0 && window.scrollY < 100) {
                    // If at very top, highlight first
                    setActiveToc(headings[0].id);
                }
            };

            window.removeEventListener('scroll', handleScroll);
            window.addEventListener('scroll', handleScroll, { passive: true });

            // Trigger once
            handleScroll();
        }

        function setActiveToc(id) {
            const links = pageTocContainer.querySelectorAll('a');
            links.forEach(link => {
                if (link.dataset.target === id) {
                    link.classList.remove('border-transparent', 'text-gray-600', 'text-gray-400', 'hover:border-wemd-green/30');
                    link.classList.add('border-wemd-green', 'text-wemd-green', 'font-medium');
                } else {
                    link.classList.add('border-transparent', 'hover:border-wemd-green/30');
                    link.classList.remove('border-wemd-green', 'text-wemd-green', 'font-medium');
                    if (link.classList.contains('pl-8')) { // H3
                        link.classList.add('text-gray-400');
                    } else { // H2
                        link.classList.add('text-gray-600');
                    }
                }
            });
        }


        function handleHash() {
            // Hash format: #tutorials/quick-start-user.md
            // OR if empty -> default
            let hash = window.location.hash.substring(1);

            // Remove any potential internal anchor (e.g. #tutorials/guide.md#section-1)
            // But actually we are using single hash for routing. 
            // If user wants to link to section, we might need more complex routing.
            // For now, let's treat the whole hash as the doc path if it ends with .md

            if (!hash) {
                hash = 'tutorials/quick-start-user.md'; // Default Home
            }

            if (hash.endsWith('.md')) {
                loadDoc(hash);
            }
        }

        window.addEventListener('hashchange', handleHash);

        // Initial Load
        handleHash();

    </script>
</body>

</html>